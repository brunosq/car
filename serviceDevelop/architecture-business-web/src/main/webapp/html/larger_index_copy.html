<!DOCTYPE html>
<html>
  <head>
    <title>指挥中心</title>
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="../css/larger_index.css" type="text/css" />
  </head>
  <body>
<div id="body">
	<input type="hidden" id="totalTradeMoneyHide" value=""/> 
	<div id="title"><span>全国累计交易额</span><div id="totalTradeMoney" class="digits"></div>元</div>
	<!-- 详情 -->
	<div class="closeWin" style="margin-left: 43%;">
		<img style="display: none" id="companyDetailClose" src="../images/close.png" onclick="comDetailClose()"/>
		<div id="companyDetail" style="display: none"></div>
	</div>
	<!-- 列表 -->
	<div class="closeWin" style="margin-left: 55%">
		<img style="display: none" id="companyListClose" src="../images/close.png" onclick="comListClose()"/>
		<div id="companyList" style="display:none"></div>
	</div>
	<!-- 动态箭头 -->
	<div id="arrowsDiv" style="position: absolute;margin-top: 0%;z-index: 1;"></div>
	<div id="main">
		<div id="left">
			<div id="left_top">
				<div id="tradeChart"></div>
			</div>
			<div id="left_bottom"></div>
			<div class="left_bottom_rate">
				<span style="margin-right:10%">货源发布率环比增长</span>
				<span style="margin-right:8%">货源报价率环比增长</span>
				<span>货源成单率环比增长</span>
			</div>
			<div class="left_bottom_growth">
				<span style="margin-right:10%">货源发布率同比增长</span>
				<span style="margin-right:8%">货源报价率同比增长</span>
				<span>货源成单率同比增长</span>
			</div>
		</div>
		<div id="map">
		</div>
		<div id="right">
			<div id="rightTop">
				<span id="province"></span>
				<div id="provinceMoney" class="digits"></div>元
			</div>
			<div id="childMap"></div>
			<div id="rightBottom">
				<table style="width: 100%;">
					<thead style="line-height: 200px">
						<tr>
							<td colspan="3">
								<span>司机综合评价（均值）：<img style="width: 25px;height: 25px;" src="../images/starselect.png"><img style="width: 25px;height: 25px;" src="../images/starselect.png"><img style="width: 25px;height: 25px;" src="../images/starselect.png"><img style="width: 25px;height: 25px;" src="../images/starselect.png"><img style="width: 25px;height: 25px;" src="../images/starunslected.png"></span>
								<span style="margin-left: 15%">企业综合评价（均值）：<img style="width: 25px;height: 25px;" src="../images/starselect.png"><img style="width: 25px;height: 25px;" src="../images/starselect.png"><img style="width: 25px;height: 25px;" src="../images/starselect.png"><img style="width: 25px;height: 25px;" src="../images/starselect.png"><img style="width: 25px;height: 25px;" src="../images/starunslected.png"></span>
							</td>
						</tr>
					</thead>
					<tbody style="text-align: center">
						<tr>
							<td>企业总数</td>
							<td>司机总数</td>
							<td>已成单货源数</td>
						</tr>
						<tr>
						</tr>
						<tr class="number">
							<td> <div id="provinceCompanyCount" class="digits"></div> </td>
							<td> <div id="provinceDriverCount" class="digits"></div> </td>
							<td> <div id="orderGoodsCount" class="digits"></div> </td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr style="margin-top: 20px">
							<td>已发布货源数</td>
							<td>已报价货源数</td>
							<td></td>
						</tr>
						<tr class="number">
							<td> <div id="goodsCount" class="digits"></div></td>
							<td> <div id="hasPricedGoodsCount" class="digits"></div></td>
							<td></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/echarts-all.js"></script>
<script type="text/javascript" src="../js/geomap.js"></script>
<script type="text/javascript" src="../js/larger_util.js"></script>

<script type="text/javascript">

    var chinaChart;
    
    var selectedProvince='';
    
    var companyPointData;
    var provinceCompnayData;
    
    var goodsPointData;
    var provinceGoodsData;
    
    var orderData;
    
    var carData;
    var provinceCarData;
    
    var nearMonthTrade;
    var goodsRate;
    var pricedRate;
    var orderRate;
    var goodsGrowthRate;
    var pricedGrowthRate;
    var orderGrowthRate;
    
    //启动加载
    $(function(){
    	
    	var param='';
    	
    	/*1同步加载Echarts数据*/
    	getCompanyList(param);/*全国地图--企业*/
    	getGoodsList(param);/*全国地图--待报价货源*/
    	getOrderList(param);/*全国地图--订单*/
    	getUnusedCarList(param);/*全国地图--闲置车辆*/
    	
    	getNearMonthTrade(param);/*最近六个月交易额*/
    	getGoodsRate(param);/*货源报价率、发布率、成单率、环比率、同比率*/
    	getTotalTradeMoney();/*全国交易额*/
    	

    	/*2渲染Echarts*/
    	showChinaMap();
    	showRate();
    	getTradeChart();
    	
    	/*3定时刷新统计数据*/
    	runTimeTask();
    	
	});
    
    //企业
    function getCompanyList(param){getProvinceInfo
    	$.ajax({
    		url : $.base+"/center/getCompanyList",
    		data : {
    			"province":param
    		},
    		async: false,
    		type : "post",
    		dataType : "json",
    		success : function(data) {
    			if(param !==''){//省份--企业
    				provinceCompnayData=new Array();
    				provinceCompnayData=data;
    			}else{//全国--企业
    				companyPointData=new Array();
    				companyPointData=data;
    			}
    		}
    	});
    }

    //待报价货源
    function getGoodsList(param){
    	$.ajax({
    		url : $.base+"/center/getGoodsList",
    		data : {
    			"province":param
    		},
    		async: false,
    		type : "post",
    		dataType : "json",
    		success : function(data) {
    			if(param!==''){//省份--待报价货源
    				provinceGoodsData=new Array();
    				provinceGoodsData=data;
    			}else{//全国--待报价货源
    				goodsPointData=new Array();
    				goodsPointData=data;
    			}
    		}
    	});
    }
    
   //订单
    function getOrderList(param){
    	$.ajax({
    		url : $.base+"/center/getOrderList",
    		async: false,
    		type : "post",
    		dataType : "json",
    		success : function(data) {
    			orderData=new Array();
    			orderData=data;
    		}
    	});
    }
   
    
    //闲置的车辆list
    function getUnusedCarList(param){
    	$.ajax({
    		url : $.base+"/center/getUnusedCarList",
    		async: false,
    		type : "post",
    		data : {
    			"province":param
    		},
    		dataType : "json",
    		success : function(data) {
    			if(param!==''){//省份--待报价货源
    				provinceCarData=new Array();
    				provinceCarData=data;
    			}else{//全国--待报价货源
    				carData=new Array();
        			carData=data;
    			}
    			
    		}
    	});
    }
    
    //全国交易额
    function getTotalTradeMoney(){
    	$.ajax({
			url : $.base+"/center/getTotalTradeMoney",
			async: true,
			type : "post",
			dataType : "json",
			success : function(data) {
				
				$('#arrowsDiv').html('');
				
				if($('#totalTradeMoneyHide').val()!=data.totalTradeMoney){
					
					for (var i=0;i<data.newOrderLocas.length;i++){
						var loc=chinaChart.chart.map.getPosByGeo('china',data.newOrderLocas[i]);
						var width=loc[0]+1345;
						var height=loc[1]-280;
						
						var html="<img class='arrows' style='margin-top:"+height+"px;margin-left:"+width+"px' src='../images/arrow_1.png'/>";
						
						$('#arrowsDiv').append(html);
						
					}
					
		    		
	    			 $(".arrows").each(function(){
	    				 $(this).slideUp(3500,function(){
	    			 		 $(this).css('display','none');
	    			 	});
		    		 });
	    			 
				} 
				
				
				$('#totalTradeMoneyHide').val(data.totalTradeMoney)
				
				setLargerNumber($("#totalTradeMoney"), data.totalTradeMoney);
				
			}
		});  	
    }
    
    //最新六个月数据交易额
    function getNearMonthTrade(){
    	$.ajax({
			url : $.base+"/center/getNearMonthTrade",
			async: false,
			type : "post",
			dataType : "json",
			success : function(data) {
				nearMonthTrade=new Array();
				nearMonthTrade=data;
			}
		});  	
    }
    
    //货源发布率，货源报价率，货源成单率，货源发布同比增长，货源报价同比增长，货源成单同比增长
    function getGoodsRate(){
    	$.ajax({
    		url : $.base+"/center/getGoodsRate",
    		async: false,
    		type : "post",
    		dataType : "json",
    		success : function(data) {
    		    goodsRate=data.goodsRate;
    		    pricedRate=data.pricedRate;
    		    orderRate=data.orderRate;
    		    goodsGrowthRate=data.goodsGrowthRate;
    		    pricedGrowthRate=data.pricedGrowthRate;
    		    orderGrowthRate=data.orderGrowthRate;
    		}
    	});
    }
    
  //定时刷新统计数据
    function runTimeTask(){
	  
	   window.setInterval(function(){
			getProvinceInfo(selectedProvince);
		}, 1000*60*10);
	    
	    window.setInterval(function(){
	    	getTotalTradeMoney();
		}, 1000*60*2.5);
    }
    
  	//点击省份事件
    function getProvinceInfo(param){
		$.ajax({
			url : $.base+"/center/getProvinceInfo",
			data : {
				"province":param
			},
			async: true,
			type : "post",
			dataType : "json",
			success : function(data) {
				$('#province').html(param+'交易额');
				setNumber($("#provinceMoney"), data.tradeMoney);
				setNumber($("#provinceCompanyCount"), data.companyCount);
				setNumber($("#provinceDriverCount"), data.driverCount);
				setNumber($("#orderGoodsCount"),data.orderGoodsCount);
				setNumber($("#goodsCount"), data.goodsCount);
				setNumber($("#hasPricedGoodsCount"), data.hasPricedGoodsCount);
			}
		});
    }
    
    //渲染全国地图
    function showChinaMap(){
    		 chinaChart = echarts.init(document.getElementById('map'));
    		 chinaOption = {
		        backgroundColor: 'rgba(0,0,0,0)',
			    //图列
			    legend: chinaMapLegend,
			    tooltip : {
	                trigger: 'item',
	                formatter: '{b}'
	            },
			    series:[
					/****************************************************企业*******************************************************/
			            {
			            name: '企业',
			            type: 'map',
			            mapType: 'china',
			            mapLocation: {
			                x: 'center',
			                y: '3%',
			                width: '100%'
			            },
			            selectedMode: 'single',
			            roam: false,
			            itemStyle: chinaSerieItemStyle,
			            //数据源
			            data:selectCiyts,
			            markPoint : {
			            	symbol:'circle',
			                itemStyle:{
			                	normal: {
			                	color:'#a3db78',
		                        label: {
		                            show: false
		                        }
		                    },
		                    emphasis: {
		                        borderColor: '#1e90ff',
		                        borderWidth: 3,
		                        label: {
		                            show: false
		                        }
		                    }
			                },
			                //symbol: 'image://../images/icon_enterprise.png',
			                symbolSize: function(val){
			                	if(1000<val){
			                		return 15;
			                	}
		                	 	if(500<val && val<=1000){
			                		return 13;
			                	}
			                	 if(300<val && val<=500){
			                		return 11;
			                	}
			                	if(100<val && val<=300){
			                		return 10;
			                	}
			                	if(50<val && val<=100){
			                		return 8;
			                	}
			                	if(2<val && val<=50){
			                		return 7;
			                	} 
			                	if(0<val && val<=20){
			                		return 5;
			                	} 
			                	return 5;
		                	},
		                	effect:{
		                		show: false,
		                	},
			                data:companyPointData
			            },
			            geoCoord:geoCityMap
			        },
			        /**************************************************待报价货源*********************************************************/
			        {
			            name: '待报价货源',
			            type: 'map',
			            mapType: 'china',
			            mapLocation: {
			                x: 'center',
			                y: '3%',
			                width: '100%'
			            },
			            roam: false,
			            selectedMode: 'single',
			            itemStyle:chinaSerieItemStyle,
			            //数据源
			            data:selectCiyts,
			            markPoint : {
			            	symbol:'circle',
			                //symbolSize: 6,
			                //symbol: 'image://../images/goods.svg',
			                itemStyle:{
			                	normal: {
				                	color:'#38e4c2',
			                        label: {
			                            show: false
			                        }
		                    	},
			                    emphasis: {
			                        borderColor: '#38e4c2',
			                        borderWidth: 3,
			                        label: {
			                            show: false
			                        }
			                    }
			                }, symbolSize: function(val){
			                	if(200<val){
			                		return 15;
			                	}
		                	 	if(150<val && val<=200){
			                		return 13;
			                	}
			                	 if(100<val && val<=150){
			                		return 11;
			                	}
			                	if(30<val && val<=50){
			                		return 10;
			                	}
			                	if(20<val && val<=30){
			                		return 8;
			                	}
			                	if(0<val && val<=20){
			                		return 5;
			                	} 
			                	return 2;
		                	},
			                data:goodsPointData
			            }
			        },
			        /**************************************************订单*********************************************************/
			        {
			            name: '在途订单',
			            type: 'map',
			            mapType: 'china',
			            mapLocation: {
			                x: 'center',
			                y: '3%',
			                width: '100%'
			            },
			            roam: false,
			            selectedMode: 'single',
			            itemStyle:chinaSerieItemStyle,
			            //数据源
			            data:selectCiyts,
			            markLine : {
			            	symbol: ['emptyCircle','emptyCircle'],  
			                symbolSize : 3,
			                effect :  {
			            	    show: true,
			            		scaleSize: 4,
			            	    period: 20,
			            	    color: '#c6e8f2',
			            	    shadowBlur : 0 
			            	},
			                itemStyle : {
			                		normal: {
					    	            borderWidth:0.7,
					    	            borderColor:'#6fb6c1',
					    	            lineStyle: {
					    	                type: 'solid'
					    	            }
			                		} 
			           			},
			                smooth:true,
			                data : orderData
			            }
			        },
			        /**************************************************闲置的车辆*********************************************************/
			        {
			            name: '闲置的车辆',
			            type: 'map',
			            mapType: 'china',
			            mapLocation: {
			                x: 'center',
			                y: '3%',
			                width: '100%'
			            },
			            roam: false,
			            selectedMode: 'single',
			            itemStyle:chinaSerieItemStyle,
			            //数据源
			            data:selectCiyts,
			            markPoint : {
			            	symbol:'circle',
			                //symbolSize: 6,
			                //symbol: 'image://../images/car03.png',
		            	 	symbolSize: function(val){
			                	if(6000<val){
			                		return 15;
			                	}
		                	 	if(5000<val && val<=6000){
			                		return 15;
			                	}
			                	 if(4000<val && val<=5000){
			                		return 11;
			                	}
			                	if(3000<val && val<=4000){
			                		return 10;
			                	}
			                	if(1000<val && val<=2000){
			                		return 7;
			                	}
			                	if(500<val && val<=1000){
			                		return 7;
			                	} 
			                	if(300<val && val<=500){
			                		return 5;
			                	}
			                	if(0<val && val<=300){
			                		return 4;
			                	}
			                	return 4;
		                	},
			                itemStyle:{
			                	normal: {
				                	color:'#dd773b',
			                        label: {
			                            show: false
			                        }
		                    	},
			                    emphasis: {
			                        borderColor: '#38e4c2',
			                        borderWidth: 3,
			                        label: {
			                            show: false
			                        }
			                    }
			                },
			                data: carData
			            }
			        }
			        
			    ]
		};
		  
		chinaChart.setOption(chinaOption, true);
		
		window.onresize = chinaChart.resize;
		
		var isSelectedMap=false;
		/* 单击省份事件 */
		chinaChart.on(echarts.config.EVENT.MAP_SELECTED, function (param){
			 
			 isSelectedMap=true;
			 
			 comListClose();
			 
			 showChildMap(param);
		});
		
		/* 单击marketPoint事件 */
		chinaChart.on(echarts.config.EVENT.CLICK, function (param){
			if(!isSelectedMap){
				if(param.seriesIndex=='0'){
					getCompanyListByCity(param);
				}else if(param.seriesIndex=='1'){
					getGoodsListByCity(param);
				}else if(param.seriesIndex=='2'){
					getOrderListByCity(param);
				}else if(param.seriesIndex=='3'){
					getUnusedCarListByCity(param);
				}
			}
			isSelectedMap=false;
		});
		
		/*点击legend事件*/
		chinaChart.on(echarts.config.EVENT.LEGEND_SELECTED, function (param){
			comListClose();
		});
		
		window.onresize = chinaChart.resize;
		
		
     }
    
    
  	//渲染省份地图
    function showChildMap(param){
    	 
	    var name;
    	var selected = param.selected;
    	var chinaSeries = chinaOption.series[0];
    	
	    for (var i = 0, l = chinaSeries.data.length; i < l; i++) {
	        name = chinaSeries.data[i].name;
	        chinaSeries.data[i].selected = selected[name];
	        if (selected[name]) {
	            selectedProvince = name;
	        }
	    }
	    
	    if(undefined==selectedProvince){
	    	return;
	    }
    	var childChart = echarts.init(document.getElementById('childMap'));
	    
	    getCompanyList(selectedProvince);
	    
	    getGoodsList(selectedProvince);
	    
	    getUnusedCarList(selectedProvince);
	    
	    getProvinceInfo(selectedProvince);
	    
	    childOption={
    		 backgroundColor: 'rgba(0,0,0,0)',
    		 series:[
				  /**************************************************企业*********************************************************/
    		      {
    		        type: 'map',
    		        mapType: selectedProvince,
    		        selectedMode: false,
    		        itemStyle:childSerieItemStyle,
    		        mapLocation: {
    		            x: 'center',
    		            y: 'center',
    		            width: '150%',
    		        },
    		        roam: false,
    		        data:[],
    		        markPoint : {
    		        	symbolSize: 5,
		                symbol:'circle',
		                //symbol: 'image://../images/icon_enterprise.png',
		                itemStyle:{
		                	normal: {
			                	color:'#a3db78',
		                        label: {
		                            show: false
		                        }
	                    	}
		                },
		                data:provinceCompnayData,
		            },
		            geoCoord:geoCityMap
    		    },
    		    /**************************************************待报价货源*********************************************************/
    		    {
    		        type: 'map',
    		        mapType: selectedProvince,
    		        selectedMode: false,
    		        itemStyle:childSerieItemStyle,
    		        mapLocation: {
    		            x: 'center',
    		            y: 'center',
    		            width: '100%',
    		        },
    		        roam: false,
    		        data:[],
    		        markPoint : {
    		        	 symbolSize: 5,
 		                symbol:'circle',
 		                //symbol: 'image://../images/icon_goods.png',
 		                itemStyle: {
 		                	normal: {
 			                	color:'#38e4c2',
 		                        label: {
 		                            show: false
 		                        }
 	                    	}
 		                },
 		                data:provinceGoodsData
		            }
    		    },
    		    /**************************************************闲置的车辆*********************************************************/
    		    {
    		        type: 'map',
    		        mapType: selectedProvince,
    		        selectedMode: false,
    		        itemStyle:childSerieItemStyle,
    		        mapLocation: {
    		            x: 'center',
    		            y: 'center',
    		            width: '100%',
    		        },
    		        roam: false,
    		        data:[],
    		        markPoint : {
    		        	  symbolSize: 5,
  		                symbol:'circle',
  		                //symbol: 'image://../images/icon_van02.png',
  		                itemStyle: {
  		                	normal: {
  			                	color:'#38e4c2',
  		                        label: {
  		                            show: false
  		                        }
  	                    	}
  		                },
  		                data:provinceCarData
		            }
    		    }]
	    };
	    childChart.setOption(childOption, true);//显示省地图
	    
	    window.onresize = childChart.resize;
    }
  	
  	
 	//货源发布率，货源报价率，货源成单率，货源发布同比增长，货源报价同比增长，货源成单同比增长
    function showRate(){
	    	var rateChart = echarts.init(document.getElementById('left_bottom'));
	    	var lable = {
    		    normal : {
    		    	color: '#326f96',
    		        label : {
    		            formatter : function (params){
    		                return params.value + '%'
    		            },
    		            textStyle:{
    		            	fontSize:30,
    		            	fontWeight:'bold'
    		            },
    		            position : 'center'
    		        },
    		        labelLine : {
    		            show : false
    		        }
    		    }
    		};
	    	
	    	var otherLabel = {
	    		    normal : {
	    		        color: '#162d42',
	    		        label : {
	    		            show : false
	    		        },
	    		        labelLine : {
	    		            show : false
	    		        },
	    		    }
	    		};
    		
    		var radius = [80, 100];
    		var innerradius = [60, 70];
    		
    		rateOption = {
    			legend:{
    				show: false,
    				selectedMode: false,
    				data:[
    				      {name:'货源发布率环比增长'},
    				      {name:'货源报价率环比增长'},
    				      {name:'货源成单率环比增长'},
    				      {name:''},
    				      {name:''},
    				      {name:''},
    				      {name:''},
    				      {name:''},
    				      {name:'货源发布率同比增长'},
    				      {name:'货源报价率同比增长'},
    				      {name:'货源成单率同比增长'}
    				      ]
    			},
    		    series : [
    		        {
    		            type : 'pie',
    		            center : ['20%', '30%'],
    		            clockWise:false,
    		            radius : radius,
    		            data : [
    		                {name:'other', value:1000-goodsRate, itemStyle : otherLabel},
    		                {name:'货源发布率环比增长', value:goodsRate.replace(",",""), itemStyle :lable}
    		            ]
    		        },
    		        {
    		            type : 'pie',
    		            center : ['20%', '30%'],
    		            radius : innerradius,
    		            clockWise:true,
    		            data : [
    		                {name:'other', value:1000-goodsRate,itemStyle: otherLabel},
    		                {name:'货源发布率环比增长', value:goodsRate.replace(",",""), itemStyle:lable}
    		            ]
    		        },
    		        {
			            type : 'pie',
			            center : ['50%', '30%'],
			            clockWise:false,
			            radius : radius,
			            data : [
			                {name:'other', value:1000-pricedRate, itemStyle : otherLabel},
			                {name:'货源报价率环比增长', value:pricedRate.replace(",",""),itemStyle : lable}
			            ]
			        },
			        {
			            type : 'pie',
			            center : ['50%', '30%'],
			            clockWise:true,
			            radius : innerradius,
			            data : [
			                {name:'other', value:1000-pricedRate, itemStyle : otherLabel},
			                {name:'货源报价率环比增长', value:pricedRate.replace(",",""),itemStyle : lable}
			            ]
			        },
			         {
			            type : 'pie',
			            center : ['80%', '30%'],
			            clockWise:false,
			            radius : radius,
			            data : [
			                {name:'other', value:1000-orderRate, itemStyle : otherLabel},
			                {name:'货源成单率环比增长', value:orderRate.replace(",",""),itemStyle : lable}
			            ]
			        },
			        {
			            type : 'pie',
			            center : ['80%', '30%'],
			            clockWise: true,
			            radius : innerradius,
			            data : [
			                {name:'other', value:1000-orderRate, itemStyle : otherLabel},
			                {name:'货源成单率环比增长', value:orderRate.replace(",",""),itemStyle : lable}
			            ]
			        },
			        {
			            type : 'pie',
			            center : ['20%', '70%'],
			            clockWise:false,
			            radius : radius,
			            data : [
			                {name:'other', value:1000-goodsGrowthRate, itemStyle : otherLabel},
			                {name:'货源发布率同比增长', value: goodsGrowthRate.replace(",",""),itemStyle : lable}
			            ]
			        },
			        {
			            type : 'pie',
			            center : ['20%', '70%'],
			            clockWise: true,
			            radius : innerradius,
			            data : [
			                {name:'other', value:1000-goodsGrowthRate, itemStyle : otherLabel},
			                {name:'货源发布率同比增长', value:goodsGrowthRate.replace(",",""),itemStyle : lable}
			            ]
			        },
			        {
			            type : 'pie',
			            center : ['50%', '70%'],
			            clockWise:false,
			            radius : radius,
			            data : [
			                {name:'other', value:0, itemStyle : otherLabel},
			                {name:'货源报价率同比增长', value: pricedGrowthRate.replace(",",""),itemStyle : lable}
			            ]
			        },
			        {
			            type : 'pie',
			            center : ['50%', '70%'],
			            clockWise: true,
			            radius : innerradius,
			            data : [
			                {name:'other', value:0, itemStyle : otherLabel},
			                {name:'货源报价率同比增长', value:pricedGrowthRate.replace(",",""),itemStyle : lable}
			            ]
			        },
			        {
			            type : 'pie',
			            center : ['80%', '70%'],
			            clockWise:false,
			            radius : radius,
			            data : [
			                {name:'other', value:0, itemStyle : otherLabel},
			                {name:'货源成单率同比增长', value:orderGrowthRate.replace(",",""),itemStyle : lable}
			            ]
			        },
			        {
			            type : 'pie',
			            center : ['80%', '70%'],
			            clockWise: true,
			            radius : innerradius,
			            data : [
			                {name:'other', value:0, itemStyle : otherLabel},
			                {name:'货源成单率同比增长', value: orderGrowthRate.replace(",",""),itemStyle : lable}
			            ]
			        }
			        
    		    ]
    		};
    		 rateChart.setOption(rateOption, true);
 	}
 	
 	//交易额趋势图
 	function getTradeChart(){
 		
 		var tradeChart = echarts.init(document.getElementById('tradeChart'));
 		
 		userSticsOption = {
 				 tooltip: {
				    formatter: "{c}"
				 },
 				 title : {
  			        text: '交易额趋势图',
  			        x: 'center',
  			        y: 'top',
  			        textStyle:{
  			        	color:'#008ee5',
  			        	fontSize:40
  			        }
  			    },
 			    calculable : false,
 			   	grid:{
 			   		width:'100%',
 			   		height:'70%',
 			   		borderWidth: 0,
 			   		x:'0%',
 			   	    y:'17%'
 			   	},
 			    xAxis : [ {
 			            type : 'category',
 			            data : [nearMonthTrade[5].month, nearMonthTrade[4].month, nearMonthTrade[3].month, nearMonthTrade[2].month, nearMonthTrade[1].month, nearMonthTrade[0].month],
 			           	axisLabel: {
 			        	  show: true,
 			        	  margin:1,
 			        	  textStyle:{
 			        		color:'#607da5',
 			        		fontFamily:'微软雅黑',
 			        		fontSize:20
 			        	  }
 			        	},
 			       		axisLine: {
			        		show: false
			        	},
 			        	splitLine:{
 			        		show:false
 			        	}
 			        }],
 			     yAxis : [{
 			            type : 'value',
 			        	axisLabel: {
 	 			        	show: false
 	 			        },
 			        	axisLine: {
			        		show: false
			        	},
 			        	splitLine:{
 			        		show: false
 			        	}
 			        }],
 			    series : [
					{
					     type:'bar',
					     barWidth:30,
					     barGap:20,
					     itemStyle:{
					     	normal:{
					     		color:'#008ee5'
					     	}   
					    },
					    data:[nearMonthTrade[5].trade, nearMonthTrade[4].trade, nearMonthTrade[3].trade, nearMonthTrade[2].trade, nearMonthTrade[1].trade, nearMonthTrade[0].trade]
					 }
 			    ]
 			};
 		tradeChart.setOption(userSticsOption,true);
 		
 		window.onresize = tradeChart.resize;
 	}
 	
 	
 	
 	function setLargerNumber(dom, number){
		var n = String(number),len = n.length;
		//如果新的数字短于当前的，要移除多余的i
		if(dom.find("i").length > len){
			dom.find("i:gt(" + (len - 1) + ")").remove();
		}
		//移除千分位分隔符
		dom.find("b").remove();
		//开始填充每一位
		for(var i=0;i<len;++i){
			//位数不足要补
			if(dom.find("i").length < len){
				dom.append("<i></i>");
			}
			var obj = dom.find("i").eq(i);
			var y = -141* parseInt(n.charAt(i), 10);
			//加分隔符
			if(i < len - 1 && (len - i - 1) % 3 == 0)
				$("<b></b>").insertAfter(obj);
			//利用动画变换数字
			obj.animate({ backgroundPositionY:y+"px" }, 350);
		}
	};
	
	function setNumber(dom, number){
		var n = String(number),len = n.length;
		//如果新的数字短于当前的，要移除多余的i
		if(dom.find("i").length > len){
			dom.find("i:gt(" + (len - 1) + ")").remove();
		}
		//移除千分位分隔符
		dom.find("b").remove();
		//开始填充每一位
		for(var i=0;i<len;++i){
			//位数不足要补
			if(dom.find("i").length < len){
				dom.append("<i></i>");
			}
			var obj = dom.find("i").eq(i);
			var y = -60* parseInt(n.charAt(i), 10);
			//加分隔符
			if(i < len - 1 && (len - i - 1) % 3 == 0)
				$("<b></b>").insertAfter(obj);
			//利用动画变换数字
			obj.animate({ backgroundPositionY:y+"px" }, 350);
		}
	};
	
	function mouseenter(thisP){
		$(thisP).css('background-color','#3071b7');
	}
	
	function mouseleave(thisP){
		$(thisP).css('background-color','#0e4a8a');
	}
 	
	function showCompanyDetail(){
		$('#companyDetail').css('display','block');
	}
	
	/*根据city查询，企业List*/
	function getCompanyListByCity(param){
		
		$('#companyDetail').css('display','none');
		
		$('#companyDetailClose').css('display','none');
		
		$('#companyList').html('');
		
		$.ajax({
			url : $.base+"/center/getCompanyList",
			data : {
				"city":param.name
			},
			async: true,
			type : "post",
			dataType : "json",
			success : function(data) {
				var html='';
				$.each(data, function (index, item) {
					html+="<p onmouseenter='mouseenter(this)' onmouseleave='mouseleave(this)' onclick='showCompanyDetail("+item.id+")'>"+item.companyName+"</p>";
				});
				
				$('#companyList').append(html);
				
				$('#companyList').css('display','block');
				
				$('#companyListClose').css('display','block');
			}
		});
	}
	
	/*根据city查询，货源List*/
	function getGoodsListByCity(param){
		
		$('#companyDetail').css('display','none');
		
		$('#companyDetailClose').css('display','none');
		
		$('#companyList').html('');
		
		$.ajax({
			url : $.base+"/center/getGoodsList",
			data : {
				"city":param.name
			},
			async: true,
			type : "post",
			dataType : "json",
			success : function(data) {
				var html='';
				$.each(data, function (index, item) {
					var temp;
					if(item.startCounty==null || item.destCounty==null){
						if(item.startCounty==null && item.destCounty==null){
							temp=item.startCity+"--"+item.destCity+"<span class='distanceStyle'>"+item.distance+"公里"+"</span>";
						}else{
							if(item.startCounty==null){
								temp=item.startCity+"--"+item.destCounty+"("+item.destCity+")"+"<span class='distanceStyle'>"+item.distance+"公里"+"</span>";
							}
							if(item.destCounty==null){
								temp=item.startCounty+"("+item.startCity+")--"+item.destCity+"<span class='distanceStyle'>"+item.distance+"公里"+"</span>";
							}
						}
					}else{
						temp=item.startCounty+"("+item.startCity+")"+"--"+item.destCounty+"("+item.destCity+")"+"<span class='distanceStyle'>"+item.distance+"公里"+"</span>";
					}
					
					html+="<p onmouseenter='mouseenter(this)' onmouseleave='mouseleave(this)' onclick='showGoodsDetail("+item.goodsId+")'>"+temp+"</p>";
				});
				
				$('#companyList').append(html);
				
				$('#companyList').css('display','block');
				
				$('#companyListClose').css('display','block');
			}
		});
	}
	
	
	//根据订单出发地、目的地查询订单list
	function getOrderListByCity(param){
		
		$('#companyDetail').css('display','none');
		
		$('#companyDetailClose').css('display','none');
		
		$('#companyList').html('');
		
		var name=param.name.split("\>");
		var startCity=name[0];
		var destCity=name[1];
		$.ajax({
			url : $.base+"/center/getOrderListByCity",
			data : {
				"startCity":startCity,
				"destCity":destCity
			},
			async: true,
			type : "post",
			dataType : "json",
			success : function(data) {
				var html='';
				$.each(data, function (index, item) {
					var temp;
					if(item.startCounty==null || item.destCounty==null){
						if(item.startCounty==null && item.destCounty==null){
							temp=item.startCity+"--"+item.destCity;
						}else{
							if(item.startCounty==null){
								temp=item.startCity+"--"+item.destCounty+"("+item.destCity+")";
							}
							if(item.destCounty==null){
								temp=item.startCounty+"("+item.startCity+")--"+item.destCity;
							}
						}
					}else{
						temp=item.startCounty+"("+item.startCity+")"+"--"+item.destCounty+"("+item.destCity+")";
					}
					html+="<p onmouseenter='mouseenter(this)' onmouseleave='mouseleave(this)' onclick='showOrderDetail("+item.orderId+")'>"+temp+"</p>";
				});
				
				$('#companyList').append(html);
				
				$('#companyList').css('display','block');
				
				$('#companyListClose').css('display','block');
			}
		});
		
	}
	
	/*根据city查询，闲置车辆List*/
	function getUnusedCarListByCity(param){
		
		$('#companyDetail').css('display','none');
		
		$('#companyDetailClose').css('display','none');
		
		$('#companyList').html('');
		
		$.ajax({
			url : $.base+"/center/getUnusedCarList",
			data : {
				"city":param.name
			},
			async: true,
			type : "post",
			dataType : "json",
			success : function(data) {
				var html='';
				$.each(data, function (index, item) {
					html+="<p onmouseenter='mouseenter(this)' onmouseleave='mouseleave(this)' onclick='showCarDetail("+item.id+")'>"+item.driverName+"---"+item.carNum+"</p>";
				});
				
				$('#companyList').append(html);
				
				$('#companyList').css('display','block');
				
				$('#companyListClose').css('display','block');
			}
		});
	}
	
	
	/*企业详情*/
	function showCompanyDetail(companyId){
		
		$('#companyDetail').html('');
		
		$.ajax({
			url : $.base+"/center/getCompanyDetail",
			data : {
				"companyId":companyId
			},
			async: true,
			type : "post",
			dataType : "json",
			success : function(data) {
				
				var html="<p style='font-size: 25px'>企业详情</p>";
					html+="<p>企业："+data.companyName+"</p>";
					html+="<p>联系电话："+data.companyMobile+"</p>";
					html+="<p>区域注册码："+data.agentCode+"</p>";
					html+="<p>企业位置："+data.companyAddr+"</p>";
					
				$('#companyDetail').append(html);
				
				$('#companyDetail').css('display','block');
				
				$('#companyDetailClose').css('display','block');
				
			}
		});
	}
	
	/*货源详情*/
	function showGoodsDetail(goodsId){
		
		$('#companyDetail').html('');
		
		$.ajax({
			url : $.base+"/center/getGoodsDetail",
			data : {
				"goodsId":goodsId
			},
			async: true,
			type : "post",
			dataType : "json",
			success : function(data) {
				//出发地、目的地、里程数、需求车型、需求车长、重量体积、公司名称、货物名称、货物类型
				var html="<p style='font-size: 25px'>货源详情</p>";
					html+="<p>出发地："+data.startAddr+"</p>";
					html+="<p>目的地："+data.destAddr+"</p>";
					html+="<p>里程数："+data.distance+"公里</p>";
					html+="<p>需求车型："+data.carType+"</p>";
					if(data.isWeightGoods==0){//泡货
						html+="<p>体积："+data.volume+"方</p>";
					}else{//重货
						html+="<p>重量："+data.weight+"吨</p>";
					}
					html+="<p>货物名称："+data.goodsName+"</p>";
					html+="<p>货物类型："+data.goodsType+"</p>";
					html+="<p>预计发货时间："+data.startTime+"</p>";
					html+="<p>预计到达时间："+data.endTime+"</p>";
					
				$('#companyDetail').append(html);
				
				$('#companyDetail').css('display','block');
				
				$('#companyDetailClose').css('display','block');
				
			}
		});
	}
	
	/*订单详情*/
	function showOrderDetail(orderId){
		
		$('#companyDetail').html('');
		
		$.ajax({
			url : $.base+"/center/getOrderDetail",
			data : {
				"orderId":orderId
			},
			async: true,
			type : "post",
			dataType : "json",
			success : function(data) {
				//出发地、目的地、里程数、需求车型、需求车长、重量体积、公司名称、货物名称、货物类型
				var html="<p style='font-size: 25px'>订单详情</p>";
				html+="<p>订单编号："+data.orderNum+"</p>";
				html+="<p>企业："+data.comName+"</p>";
				html+="<p>司机："+data.driverName+data.driverMobile+"</p>";
				html+="<p>出发地："+data.startAddr+"</p>";
				html+="<p>目的地："+data.destAddr+"</p>";
				html+="<p>运距："+data.distance+"公里</p>";
				html+="<p>货物类型："+data.goodsType+"公里</p>";
				if(data.isWeightGoods==0){//泡货
					html+="<p>体积："+data.volume+"立方</p>";
				}else{//重货
					html+="<p>重量："+data.weight+"吨</p>";
				}
				$('#companyDetail').append(html);
				
				$('#companyDetail').css('display','block');
				
				$('#companyDetailClose').css('display','block');
				
			}
		});
	}
	
	//车辆详情
	function showCarDetail(carId){
		
		$('#companyDetail').html('');
		
		$.ajax({
			url : $.base+"/center/showCarDetail",
			data : {
				"carId":carId
			},
			async: true,
			type : "post",
			dataType : "json",
			success : function(data) {
				//司机姓名、司机评价、所在位置、车型、车长、载重
				var html="<p style='font-size: 25px'>司机详情</p>";
				html+="<p>司机姓名："+data.driverName+"</p>";
				/* html+="<p>司机评价："+data.driverName+"</p>"; */
				if(data.addr!=null){
					html+="<p>所在位置："+data.addr+"</p>";
				}
				html+="<p>车型："+data.carType+"</p>";
				html+="<p>车长："+data.carLength+"米</p>";
				html+="<p>载重："+data.loadWeight+"吨</p>";
				
				$('#companyDetail').append(html);
				
				$('#companyDetail').css('display','block');
				
				$('#companyDetailClose').css('display','block');
				
			}
		});
	}
	
	function comListClose(){
		
		$('#companyDetail').html('');
		
		$('#companyDetail').css('display','none');
		
		$('#companyDetailClose').css('display','none');
		
		$('#companyList').html('');
		
		$('#companyList').css('display','none');
		
		$('#companyListClose').css('display','none');
		
	}
	
	function comDetailClose(){
		
		$('#companyDetail').html('');
		
		$('#companyDetail').css('display','none');
		
		$('#companyDetailClose').css('display','none');
	}
    </script>
  </body>
</html>